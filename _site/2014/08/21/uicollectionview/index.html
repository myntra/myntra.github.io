<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="UTF-8">
  <link href="http://gmpg.org/xfn/11" rel="profile">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Customising an iOS UICollectionView Layout &middot; Myntra Engineering
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/styles.css">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/atom+xml" title="Myntra Engineering" href="/atom.xml">
</head>


  <body>

    <div class="container content">
      <header class="masthead">
        <h3 class="masthead-title">
          <a href="/" title="Home">Myntra Engineering</a>
          <small>Stories of code.</small>
        </h3>
      </header>

      <main>
        <article class="post">
  <h1 class="post-title">Customising an iOS UICollectionView Layout</h1>
  <time datetime="2014-08-21T00:00:00+05:30" class="post-date">21 Aug 2014</time>
  <p>Introduced in iOS 6, <code>UICollectionView</code> is a more powerful extension of <code>UITableView</code>. While a table view only allows you to layout rows vertically - the number of different interactions that can be implemented with a collection view are huge. You could make a carousel, a gallery or even a circular layout of objects. And its all thanks to the fact that you can create your own custom layout logic for the items in the collection.</p>

<p>If you have never used <code>UICollectionView</code> before, then head over to NSHipster and read <a href="http://nshipster.com/uicollectionview/">Mattt Thompson’s excellent introduction</a>. Or if you would like to learn about creating custom layouts in detail, then head over to Objc Magazine and read <a href="http://www.objc.io/issue-3/collection-view-layouts.html">Ole Begemann’s post</a>. If you really want to lose your mind about the possibilities of a <code>UICollectionView</code>, then see <a href="http://www.objc.io/issue-5/collection-views-and-uidynamics.html">UICollectionView + UIKit Dynamics</a> and <a href="http://www.objc.io/issue-12/collectionview-animations.html">Animating Collection Views</a>.</p>

<p>Using the <code>UICollectionViewFlowLayout</code>, the attributes for each item in the collection view can be be specified manually. So you could position them in a circle, or you could tilt them sideways as the collection view scrolls - achieving a carousel effect. When we were developing the <a href="https://itunes.apple.com/in/app/myntra-indias-fashion-store/id907394059?mt=8">Myntra iOS app</a>, we needed a way to have a sticky header for the search results. This header would then show prominent <em>Sort</em> and <em>Filter</em> buttons.</p>

<p><img src="https://31.media.tumblr.com/4d96a4d57547340292fe11fb37d95211/tumblr_inline_nan10mKktd1qbzhpz.png" alt="Search Results Screen Design" /></p>

<p>The sort/filter bar at the top is a section header in the collection of search results. So when you scroll down the results, the bar remains sticky at the top of the view. A quick search pointed us to <a href="https://github.com/jamztang/CSStickyHeaderFlowLayout">CSStickyHeaderFlowLayout</a> which is a simple flow layout subclass to achieve sticky headers.</p>

<p>But soon we needed sticky footers too. The idea was to make the <em>Buy Now</em> bar on the product page to stick to the bottom of the screen when you scrolled through the details of the product.</p>

<p>The output of this effort is <code>MYNStickyFlowLayout</code>, a drop-in collection view layout class, that gives you sticky headers and footers for collection views. Let’s dive into <a href="https://github.com/myntra/MYNStickyFlowLayout/blob/master/Classes/MYNStickyFlowLayout.m">the code</a> and understand what is going on.</p>

<p><img src="http://myntra.myntassets.com/myx/images/Example.7fdcdb0de31e76c13eeb8ee61db5f06411aa6e43.gif" alt="" /></p>

<p>Let’s walk through what it takes to implement a custom layout for <code>UICollectionView</code>. First you subclass <code>UICollectionViewFlowLayout</code>, because that is an excellent starting point. The most important method to implement is <code>- (NSArray *)layoutAttributesForElementsInRect:(CGRect)rect</code>. This is called by <code>UICollectionView</code> everytime it needs to display cells on the screen. It does this even before the cells are created. This is because the output of this method determines which cells are on screen and hence need to be displayed.</p>

<p>The view calls this method and expects an array of <code>UICollectionViewLayoutAttribute</code> objects in return. These objects have properties like <code>frame</code>, <code>transform</code>, <code>alpha</code> etc. that you can configure. In most cases, you probably want to start with the attributes generated by the parent class - <code>UICollectionViewFlowLayout</code>. Do this by calling <code>[super layoutAttributesForElementsInRect:rect]</code> and storing it in a mutable array because we are going to be making changes.</p>

<p>In our case, we iterate over all these attributes and pick out the headers, the footers, and the first and the last cells in each of the sections. Then we iterate over the first cells in each section. This is because when you scroll down, the first cell of the section will take the footer sticking to the bottom along with it as it scrolls out the bottom of the screen. Similar logic for the headers and the last cells in each of the sections.</p>

<p>Now, because the collection view assumes that the header/footer is not on the screen, the layout attributes that we got from the parent class might not contain the layout attributes for the header/footer and hence the view will not create them, and hence they won’t show on screen. So if we don’t find them, then we quickly add them to the array.</p>

<p>Also while we are at it, we position them based on the position of the first/last cells. The final effect is that as the section scrolls out of view, it takes it’s header or footer along with it.</p>

<p>Everytime the collection view scrolls, it recalculates these attributes. And finds the best position for the section headers and footers. Thanks to all of this math, we finally get a sticky footer for the product details screen.</p>

<p><img src="http://myntra.myntassets.com/myx/images/Bag.e44c947f0fcaf4ef94e1674a29ea1baba1c98304.gif" alt="" /></p>

<p>What you see are two sections, and the first section has the <em>Buy Now</em> bar as a section footer. Hence it remains on screen while you are viewing the first section.</p>

<p>So that wraps up this post! Head over to <a href="https://github.com/myntra/MYNStickyFlowLayout">MYNStickyFlowLayout on Github</a> and try it out with the included example Xcode project. It is avaliable as a <em>CocoaPod</em> with the same name - <code>MYNSticklyFlowLayout</code>. Read the documentation on the repository to learn how you can use it in your project. Good luck!</p>

</article>

<aside class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
  </ul>
</aside>

      </main>

      <footer class="footer">
        <small>
          &copy; <time datetime="2015-05-12T17:57:03+05:30">2015</time>. All rights reserved.
        </small>
      </footer>
    </div>

  </body>
</html>
